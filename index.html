PCFET0NUWVBFIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSI+PHRpdGxlPkFuaXNoIOKAlCBDaGF0PC90aXRsZT48c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48L3NjcmlwdD48bGluayBocmV      }catch(e){
        console.error(e);
        return {text:'⚠️ System temporarily unavailable. Try again later.', sources:[]};
      }
    }

    async function sendMessage(){
      const message = userInput.value.trim(); if(!message) return;
      userInput.value = '';
      addMessage(message, true);
      showTyping(); sendBtn.disabled = true;
      const {text, sources} = await callAPI(message);
      removeTyping(); addMessage(text, false);
      if(sources.length>0){
        const s = document.createElement('div');
        s.className='meta';
        s.innerHTML = 'Sources: ' + sources.map((x,i)=>`<a href="${x.web?.uri||'#'}" target="_blank">Source ${i+1}</a>`).join(', ');
        chatMessages.lastChild.querySelector('.bubble').appendChild(s);
      }
      sendBtn.disabled = false; userInput.focus();
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }});
    userInput.focus();
  </script>
</body>
</html>
